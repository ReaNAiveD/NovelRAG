You are an expert at managing and updating relationships between story resources. Based on the provided source resource, target resource, existing relationship, operation, and relation description, you need to generate a JSON response containing the updated relationship list.

## Understanding the Task

You are tasked with intelligently updating relationships by:

- **Holistic Analysis**: Considering all existing relationships, not just the target one
- **Semantic Understanding**: Understanding what the operation and description mean in context
- **Relationship Coherence**: Ensuring updated relationships make logical sense together
- **Conflict Resolution**: Handling cases where new relationships might conflict with existing ones
- **Narrative Consistency**: Maintaining relationships that support the story's logic and flow

## Relationship Processing Guidelines

When updating relationships, consider:

1. **Current State**: Analyze existing relationships between source and target resources
2. **Operation Intent**: Understand what add/update/delete operations should accomplish
3. **Semantic Implications**: Consider how changes affect the overall relationship landscape
4. **Narrative Logic**: Ensure relationships make sense given resource properties and story context
5. **Coherence Maintenance**: Keep relationships logically consistent and emotionally realistic
6. **Completeness**: Don't leave relationship gaps that would confuse the narrative

## Operation Analysis

### Add Operation
- **Read operation as enhancement**: Establish new relationship while considering existing ones
- **Identify consolidation opportunities**: Multiple weak relationships may become one stronger relationship
- **Note implied relationships**: New relationships often suggest additional related connections
- **Understand relationship evolution**: How the new relationship changes the dynamic

### Update Operation
- **Analyze relationship transformation**: How existing relationships should change or evolve
- **Consider relationship hierarchy**: Maintain appropriate importance and intensity levels
- **Identify related adjustments**: Other relationships that need updating for coherence
- **Preserve emotional continuity**: Keep realistic emotional progression

### Delete Operation
- **Understand removal scope**: What specific aspect of relationships should be removed
- **Plan rebalancing strategy**: How remaining relationships should adjust to fill gaps
- **Maintain connection logic**: Ensure realistic emotional transitions after removal
- **Preserve narrative sense**: Keep relationships that still make story sense

## Relationship Update Strategy

### Context Analysis
1. **Resource Properties**: Use character traits, object types, location atmospheres to inform relationships
2. **Existing Relationships**: Build upon or modify current relationship patterns
3. **Story Implications**: Consider how changes support narrative development
4. **Emotional Realism**: Ensure relationship changes feel authentic and believable

### Quality Guidelines
- **Specificity**: Use precise, descriptive relationship language
- **Emotional Depth**: Include emotional nuance and complexity where appropriate
- **Narrative Support**: Relationships should enhance story development
- **Coherence**: All relationships in the list should make sense together

## Response Format

Your response must be a valid JSON object with a "relations" key containing a list of relationship description strings. This represents the updated relationship list between the source and target resources.

**DO NOT** wrap the response in any markdown code blocks or additional explanation. Return only the raw JSON object.

## Examples

### Example 1: Add Operation - Character to Character Mentorship
**Source Resource**:
```json
{
  "id": "protagonist_alex",
  "uri": "/character/protagonist_alex",
  "aspect": "character",
  "name": "Alex",
  "age": 17,
  "traits": ["curious", "brave"]
}
```

**Target Resource**:
```json
{
  "id": "wise_mentor",
  "uri": "/character/wise_mentor",
  "aspect": "character",
  "name": "Master Chen",
  "age": 65,
  "traits": ["wise", "patient", "powerful"]
}
```

**Existing Relations**: ["respects", "learns from"]
**Operation**: "add"
**Relation Description**: "becomes formal apprentice of"

**Response**:
```json
{
  "relations": ["respects", "learns from", "becomes formal apprentice of", "seeks guidance from"]
}
```

### Example 2: Update Operation - Character Relationship Enhancement
**Source Resource**:
```json
{
  "id": "detective_jane",
  "uri": "/character/detective_jane",
  "aspect": "character",
  "name": "Jane Watson",
  "profession": "Detective",
  "traits": ["analytical", "empathetic"]
}
```

**Target Resource**:
```json
{
  "id": "colleague_sarah",
  "uri": "/character/colleague_sarah",
  "aspect": "character",
  "name": "Sarah Kim",
  "profession": "Forensic Analyst",
  "traits": ["meticulous", "loyal"]
}
```

**Existing Relations**: ["works with", "knows professionally", "shares coffee breaks with"]
**Operation**: "update"
**Relation Description**: "becomes close friends and trusted confidant"

**Response**:
```json
{
  "relations": ["becomes close friends and trusted confidant", "shares personal secrets with"]
}
```

### Example 3: Delete Operation - Character Romantic Breakup with Rebalancing
**Source Resource**:
```json
{
  "id": "writer_emma",
  "uri": "/character/writer_emma",
  "aspect": "character",
  "name": "Emma Stone",
  "profession": "Novelist",
  "traits": ["passionate", "romantic", "sensitive"]
}
```

**Target Resource**:
```json
{
  "id": "former_partner",
  "uri": "/character/former_partner",
  "aspect": "character",
  "name": "David Chen",
  "profession": "Artist",
  "traits": ["creative", "moody", "talented"]
}
```

**Existing Relations**: ["is in love with", "lives with", "shares dreams with", "trusts completely"]
**Operation**: "delete"
**Relation Description**: "romantic involvement"

**Response**:
```json
{
  "relations": ["maintains friendship with", "has complicated history with", "still cares about"]
}
```

### Example 4: Add Operation - Character to Organization Aspect
**Source Resource**:
```json
{
  "id": "young_mage",
  "uri": "/character/young_mage",
  "aspect": "character",
  "name": "Luna Brightstar",
  "age": 16,
  "magical_ability": "healing",
  "traits": ["eager", "determined"]
}
```

**Target Resource**:
```json
{
  "name": "organization",
  "children_keys": ["guilds", "societies"],
  "description": "Various magical organizations and societies",
  "metadata": {"influence": "high", "secrecy_level": "medium"},
  "root_elements": [{"id": "mages_guild"}, {"id": "healers_circle"}]
}
```

**Existing Relations**: ["knows about", "has heard rumors of"]
**Operation**: "add"
**Relation Description**: "becomes secret member of"

**Response**:
```json
{
  "relations": ["becomes secret member of", "swears loyalty to", "receives missions from", "hides involvement with"]
}
```

### Example 5: Update Operation - Character to Guild Leadership
**Source Resource**:
```json
{
  "id": "experienced_mage",
  "uri": "/character/experienced_mage",
  "aspect": "character",
  "name": "Marcus Shadowweaver",
  "age": 35,
  "magical_ability": "illusion",
  "rank": "journeyman"
}
```

**Target Resource**:
```json
{
  "id": "mages_guild",
  "uri": "/organization/mages_guild",
  "aspect": "organization",
  "name": "Circle of Arcane Arts",
  "type": "magical_guild",
  "influence": "regional",
  "members_count": 247
}
```

**Existing Relations**: ["studies at", "pays dues to", "attends meetings of"]
**Operation**: "update"
**Relation Description**: "becomes inner circle leader of"

**Response**:
```json
{
  "relations": ["becomes inner circle leader of", "holds ancient secrets of", "guides policy for", "represents in external affairs"]
}
```

### Example 6: Add Operation - Character to Object Conflict Discovery
**Source Resource**:
```json
{
  "id": "treasure_hunter",
  "uri": "/character/treasure_hunter",
  "aspect": "character",
  "name": "Raven Blackthorne",
  "profession": "Treasure Hunter",
  "traits": ["reckless", "greedy", "skilled"]
}
```

**Target Resource**:
```json
{
  "id": "cursed_amulet",
  "uri": "/object/cursed_amulet",
  "aspect": "object",
  "name": "Amulet of Whispered Souls",
  "type": "cursed_jewelry",
  "power_level": "high",
  "curse_type": "mind_influence"
}
```

**Existing Relations**: ["owns", "wears daily"]
**Operation**: "add"
**Relation Description**: "discovers dark corruption within"

**Response**:
```json
{
  "relations": ["owns", "discovers dark corruption within", "fears the power of", "struggles to remove", "is slowly influenced by"]
}
```

## Your Task

Update the relationship list between the source and target resources based on the operation and relation description.

**Source Resource**: {{ source_resource | tojson }}

**Target Resource**: {{ target_resource | tojson }}

**Existing Relations**: {{ existing_relation | tojson }}

**Operation**: {{ operation }}

**Relation Description**: {{ relation_description }}

## Instructions

1. **Analyze the source resource** to understand its properties and context
2. **Examine the target resource** to understand what kind of entity it is and its characteristics
3. **Review existing relations** to understand the current relationship state
4. **Process the operation type** (add/update/delete) according to its semantic meaning
5. **Apply the relation description** while considering existing relationships for coherence
6. **Resolve any conflicts** between new and existing relationship descriptions intelligently
7. **Maintain narrative logic** ensuring all relationships make sense together
8. **Generate complete relationship list** with appropriate emotional and narrative depth
9. **Format as clean JSON** with "relations" key containing list of relationship strings

Generate the updated relationship list as a JSON object:
