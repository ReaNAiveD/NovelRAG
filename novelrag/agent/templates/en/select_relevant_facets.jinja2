You are an expert at selecting the most relevant knowledge facets for a given task or step. Based on the step information provided, you need to identify which existing facets contain knowledge that would be most useful for executing the current step.

## Understanding the Task

You are tasked with facet selection by:

- **Step Analysis**: Understanding what the current step intends to accomplish
- **Tool Requirements**: Considering what type of information the tool typically needs
- **Context Matching**: Identifying which facets contain relevant knowledge
- **Relevance Scoring**: Prioritizing facets by their utility for the current step
- **Focused Selection**: Choosing a manageable number of most relevant facets

## Facet Relevance Criteria

When evaluating facet relevance, consider:

1. **Direct Tool Alignment**: Facets that directly support the tool's function
2. **Intent Matching**: Knowledge that aligns with the step's stated intent
3. **Domain Overlap**: Facets covering the same subject area or domain
4. **Dependency Requirements**: Knowledge needed as prerequisites for the step
5. **Context Enrichment**: Information that would improve step execution quality
6. **Constraint Awareness**: Facets containing relevant limitations or requirements

## Selection Strategy

### High Priority Selection
- **Exact Matches**: Facets directly related to the tool or intent
- **Prerequisites**: Knowledge required before the step can execute successfully
- **Core Context**: Essential background information for the task

### Medium Priority Selection
- **Supporting Information**: Knowledge that enhances but isn't critical for execution
- **Related Domains**: Adjacent topics that provide useful context
- **Process Guidance**: Workflow or methodology insights

### Low Priority Selection
- **General Background**: Broad context that might be tangentially useful
- **Reference Material**: Information that could be consulted if needed

## Response Format

Your response must be a valid JSON object with a "facets" key containing an array of selected facet names, ordered by relevance (most relevant first).

**DO NOT** wrap the response in any markdown code blocks or additional explanation. Return only the raw JSON object.

## Examples

### Example 1: Character Dialogue Generation
**Step Info**:
```json
{
  "tool": "dialogue_generator",
  "intent": "Create conversation between Sarah and her mother about family restaurant"
}
```

**Available Facets**: ["character Sarah Chen core identity and background", "Sarah Chen family relationships and dynamics", "Victorian London environmental atmosphere and sensory details", "character personality traits for dialogue development", "Victorian social class structure and geographical divisions"]

**Response**:
```json
{
  "facets": ["Sarah Chen family relationships and dynamics", "character personality traits for dialogue development", "character Sarah Chen core identity and background"]
}
```

### Example 2: Scene Location Research
**Step Info**:
```json
{
  "tool": "location_researcher",
  "intent": "Find suitable Victorian London locations for detective investigation scenes"
}
```

**Available Facets**: ["character Sarah Chen core identity and background", "Victorian London environmental atmosphere and sensory details", "Victorian crime patterns and criminal organization", "Victorian social class structure and geographical divisions", "dialogue generation requirements and prerequisites"]

**Response**:
```json
{
  "facets": ["Victorian London environmental atmosphere and sensory details", "Victorian crime patterns and criminal organization", "Victorian social class structure and geographical divisions"]
}
```

### Example 3: Plot Development Planning
**Step Info**:
```json
{
  "tool": "plot_planner",
  "intent": "Develop the middle act connecting character introduction to climax"
}
```

**Available Facets**: ["character Sarah Chen core identity and background", "father murder case motivation and plot driver", "story structure and narrative development", "conflict resolution patterns and techniques", "character personality traits for dialogue development", "Victorian crime patterns and criminal organization"]

**Response**:
```json
{
  "facets": ["father murder case motivation and plot driver", "story structure and narrative development", "character Sarah Chen core identity and background", "conflict resolution patterns and techniques"]}
```

### Example 4: Research and Fact Checking
**Step Info**:
```json
{
  "tool": "fact_checker",
  "intent": "Verify historical accuracy of Victorian police procedures described in chapter 3"
}
```

**Available Facets**: ["Victorian London environmental atmosphere and sensory details", "character Sarah Chen core identity and background", "Victorian crime patterns and criminal organization", "Victorian social class structure and geographical divisions", "research methodology and source verification", "police procedural requirements and protocols"]

**Response**:
```json
{
  "facets": ["police procedural requirements and protocols", "Victorian crime patterns and criminal organization", "research methodology and source verification"]}
```

### Example 5: Character Relationship Development
**Step Info**:
```json
{
  "tool": "relationship_mapper",
  "intent": "Map complex family dynamics between three generations of the Chen family"
}
```

**Available Facets**: ["character Sarah Chen core identity and background", "Sarah Chen family relationships and dynamics", "cultural background and community ties", "character personality traits for dialogue development", "Victorian London demographic and population context", "family business operations and dynamics"]

**Response**:
```json
{
  "facets": ["Sarah Chen family relationships and dynamics", "character Sarah Chen core identity and background", "cultural background and community ties", "family business operations and dynamics"]}
```

### Example 6: Technical Writing Task
**Step Info**:
```json
{
  "tool": "style_editor",
  "intent": "Improve prose style and flow in the opening chapter"
}
```

**Available Facets**: ["character Sarah Chen core identity and background", "Victorian London environmental atmosphere and sensory details", "writing techniques and style guidelines", "narrative pacing and rhythm patterns", "reader engagement and voice development", "dialogue generation requirements and prerequisites"]

**Response**:
```json
{
  "facets": ["writing techniques and style guidelines", "narrative pacing and rhythm patterns", "reader engagement and voice development"]}
```

## Your Task

Select the most relevant facets for the current step.

**Step Information:**
```json
{{ step_info }}
```

**Available Facets:**
{% for facet in available_facets %}
- {{ facet }}
{% endfor %}

**Maximum Facets to Select:** {{ max_facets }}

## Instructions

1. **Analyze the step's tool and intent** to understand what type of knowledge would be most useful
2. **Evaluate each available facet** for its relevance to the current task
3. **Consider tool-specific requirements** - different tools need different types of context
4. **Prioritize by direct utility** - focus on facets that directly support the step's success
5. **Balance specificity and breadth** - include both precise matches and supporting context
6. **Respect the maximum limit** - select up to the specified number of most relevant facets
7. **Order by relevance** - place the most critical facets first in the array
8. **Focus on actionable knowledge** - prefer facets with information the tool can actually use
9. **Consider step dependencies** - include facets with prerequisite information
10. **Format as clean JSON** - return only the JSON object with the facets array

Generate the selected facets as a JSON object:
