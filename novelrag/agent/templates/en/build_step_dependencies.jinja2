You are an expert at analyzing step dependencies and building execution dependency graphs. Based on the provided step lists, you need to generate a JSON response containing dependency mappings that show which steps contribute to which other steps.

## Understanding the Task

You are tasked with building step dependencies by:

- **Dependency Analysis**: Understanding how newly added steps relate to and depend on existing scheduled steps
- **Graph Construction**: Creating a dependency graph using 'contribute_to' relationships for insertion planning
- **Logical Flow**: Ensuring dependencies follow a logical execution order when new steps are inserted before existing ones
- **Contribution Mapping**: Identifying which new steps provide input or foundation for other steps (both new and existing)
- **Sequence Indexing**: Using sequence indices to reference steps across new and existing step lists
- **Single Dependencies**: Ensuring each new step contributes to at most one other step

## Dependency Building Guidelines

### Understanding Step Relationships
Steps can have the following types of dependencies:
- **Input Dependencies**: One step provides data/results needed by another step
- **Prerequisite Dependencies**: One step must complete before another can start
- **Foundation Dependencies**: One step establishes context or state needed by another
- **Sequential Dependencies**: Steps that naturally follow each other in logical order

### Contribution Rules
1. **Single Contribution**: Each step in the new steps list can only contribute to ONE other step
2. **Forward References**: New steps can only contribute to steps that come later in the final execution order
3. **Cross-List Dependencies**: New steps can contribute to either other new steps or existing scheduled steps
4. **Chain Resolution**: If a new step could contribute to multiple steps, choose the earlier one in the execution chain
5. **Logical Precedence**: Dependencies should reflect logical execution order when new steps are inserted before existing ones
6. **Insertion Context**: Remember that new steps will be inserted before existing steps in the final schedule
7. **Terminal Steps**: When there are no existing steps, the final new step should have contribute_to set to null

### Sequence Index System
- **New Steps (new_steps)**: Referenced using indices 0, 1, 2, ... (0-based indexing)
- **Existing Steps (existing_steps)**: Referenced using indices 0, 1, 2, ... (0-based indexing)  
- **Dependencies Format**: Use "new:index" for new steps, "existing:index" for existing steps
- **Null Dependencies**: Use null for steps that don't contribute to any other step

### Decision Making Process
When a new step could potentially contribute to multiple other steps:
1. **Analyze the execution chain**: Check if the first candidate step also contributes to the second
2. **Choose the earlier step**: Select the step that comes first in the final execution order
3. **Avoid redundancy**: Prefer direct dependencies over transitive ones
4. **Prioritize foundation**: Choose the step that provides the most fundamental input
5. **Consider insertion order**: Remember new steps will execute before existing steps
6. **Handle empty existing steps**: If no existing steps are provided, the final new step should contribute to null

## Response Format

Your response must be a valid JSON object with the following structure:
```json
{
  "dependencies": [
    {
      "step_index": 0,
      "contribute_to": "existing:1",
      "reasoning": "Brief explanation of why this dependency exists"
    },
    {
      "step_index": 1,
      "contribute_to": null,
      "reasoning": "Brief explanation of why this step doesn't contribute to others"
    }
  ]
}
```

## Examples

### Example 1: Adding Character Creation Steps to Existing Workflow
**New Steps (new_steps)** - to be inserted:
- Index 0: {"tool": "story_reader", "intent": "Read existing character profiles to understand current cast"}
- Index 1: {"tool": "world_reader", "intent": "Read world-building details about character origins and cultures"}
- Index 2: {"tool": "character_creator", "intent": "Create a new supporting character based on world context"}

**Existing Steps (existing_steps)** - already scheduled:
- Index 0: {"tool": "relationship_editor", "intent": "Establish relationships between the new character and existing ones"}
- Index 1: {"tool": "scene_editor", "intent": "Update existing scenes to include the new character"}

**Dependencies**:
```json
{
  "dependencies": [
    {
      "step_index": 0,
      "contribute_to": "new:2",
      "reasoning": "Character profiles provide context needed for creating compatible new character"
    },
    {
      "step_index": 1,
      "contribute_to": "new:2", 
      "reasoning": "World-building context informs character creation with appropriate cultural background"
    },
    {
      "step_index": 2,
      "contribute_to": "existing:0",
      "reasoning": "New character must be created before establishing relationships with existing characters"
    }
  ]
}
```

### Example 2: Adding Research Steps to Scene Development Workflow
**New Steps (new_steps)** - to be inserted:
- Index 0: {"tool": "plot_reader", "intent": "Read current plot outline to understand story context"}
- Index 1: {"tool": "character_reader", "intent": "Read character motivations and current emotional states"}
- Index 2: {"tool": "location_reader", "intent": "Read details about the scene setting and environment"}
- Index 3: {"tool": "scene_creator", "intent": "Create the new scene incorporating all gathered context"}

**Existing Steps (existing_steps)** - already scheduled:
- Index 0: {"tool": "dialogue_editor", "intent": "Refine character dialogue in the created scene"}
- Index 1: {"tool": "pacing_analyzer", "intent": "Analyze and adjust scene pacing for optimal flow"}

**Dependencies**:
```json
{
  "dependencies": [
    {
      "step_index": 0,
      "contribute_to": "new:3",
      "reasoning": "Plot context provides essential story framework for scene creation"
    },
    {
      "step_index": 1,
      "contribute_to": "new:3",
      "reasoning": "Character states inform dialogue and actions within the scene"
    },
    {
      "step_index": 2,
      "contribute_to": "new:3",
      "reasoning": "Location details provide setting and environmental context for scene creation"
    },
    {
      "step_index": 3,
      "contribute_to": "existing:0",
      "reasoning": "Scene must exist before dialogue can be refined - choose dialogue over pacing as more direct dependency"
    }
  ]
}
```

### Example 3: Adding Steps to Empty Schedule
**New Steps (new_steps)** - to be inserted:
- Index 0: {"tool": "outline_reader", "intent": "Read the story outline to understand the overall plot structure"}
- Index 1: {"tool": "character_reader", "intent": "Read all character profiles to understand the cast"}
- Index 2: {"tool": "world_reader", "intent": "Read world-building details to understand the setting"}
- Index 3: {"tool": "scene_creator", "intent": "Create the opening scene based on all gathered context"}

**Existing Steps (existing_steps)** - already scheduled:
(No existing steps)

**Dependencies**:
```json
{
  "dependencies": [
    {
      "step_index": 0,
      "contribute_to": "new:3",
      "reasoning": "Story outline provides plot framework needed for scene creation"
    },
    {
      "step_index": 1,
      "contribute_to": "new:3",
      "reasoning": "Character profiles inform character behavior and dialogue in the scene"
    },
    {
      "step_index": 2,
      "contribute_to": "new:3",
      "reasoning": "World-building context provides setting details for the scene"
    },
    {
      "step_index": 3,
      "contribute_to": null,
      "reasoning": "Final step with no existing steps to contribute to - terminates the workflow"
    }
  ]
}
```

## Important Notes

- **Single Dependencies Only**: Each step in the new steps list contributes to exactly one other step or none at all
- **Chain Analysis**: When multiple dependencies are possible, trace the logical chain and choose the earlier step
- **List References**: Use "new:index" for new_steps and "existing:index" for existing_steps
- **Null Values**: Use null for steps that don't contribute to any other step (often final steps)
- **Empty Existing Steps**: When there are no existing steps, the final new step should have contribute_to set to null
- **Execution Order**: Remember that new steps will be inserted before existing steps in the final schedule
- **Cross-List Support**: New steps can contribute to either other new steps or existing scheduled steps
- **Reasoning Required**: Each dependency decision must include clear reasoning
- **Insertion Planning**: Consider how the new steps will integrate with the existing workflow

## Current Task

You will now be provided with two lists of steps to analyze for dependencies. The new steps will be inserted before the existing steps in the final schedule.

### New Steps (new_steps)

These are the newly added steps for which you need to determine 'contribute_to' relationships:

{% for step in new_steps %}
- **Index {{ loop.index0 }}**: Tool: "{{ step.tool }}", Intent: "{{ step.intent }}"
{% endfor %}

### Existing Steps (existing_steps)

These are the steps already scheduled that the new steps will be inserted before:

{% if existing_steps %}
{% for step in existing_steps %}
- **Index {{ loop.index0 }}**: Tool: "{{ step.tool }}", Intent: "{{ step.intent }}"
{% endfor %}
{% else %}
(No existing steps - new steps will form the complete initial schedule)
{% endif %}

## Your Task

Analyze the relationships between these steps and build a dependency graph by:

1. **Examining each new step** to understand what information or results it produces
2. **Identifying which later steps** (either other new steps or existing steps) would benefit from those results
3. **Choosing single dependencies** when multiple options exist, preferring the earlier step in execution chains
4. **Using proper indexing** with "new:index" or "existing:index" format
5. **Providing clear reasoning** for each dependency decision
6. **Handling independent steps** by setting contribute_to to null
7. **Considering insertion context** - remember new steps execute before existing steps
8. **Handling empty existing steps** - if no existing steps are provided, the final new step should contribute to null

Remember: Each step in the new steps list should contribute to at most one other step. If you identify that a step could contribute to multiple steps, analyze whether the first step also contributes to the second, and if so, choose the first step. When there are no existing steps, the last new step should have contribute_to set to null since there's nothing following it.

Provide your response as a valid JSON object following the specified format.